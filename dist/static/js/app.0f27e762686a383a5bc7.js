webpackJsonp([1],{NHnr:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("7+uW"),n=i("mtWM"),s=i.n(n),o={imgPath:"http://127.0.0.1:9001/img/",apiPath:"http://127.0.0.1:9000/",getTodayTime:function(){var t=new Date;return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t.getTime()},prevDay:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(new Date).getTime(),e=new Date(t);return""+e.getFullYear()+(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+(e.getDate()<10?"0"+e.getDate():e.getDate())},getDay:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(new Date).getTime();return""+["日","一","二","三","四","五","六"][new Date(t).getDay()]}};o.ajax=s.a.create({baseURL:o.apiPath}),o.ajax.interceptors.response.use(function(t){return t.data});var c=o,r={name:"item",props:{data:{type:Object}},data:function(){return{imgPath:c.imgPath}}},l={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a",{staticClass:"daily-item",attrs:{href:"#"}},[t.data.images?i("div",{staticClass:"daily-img"},[i("img",{attrs:{src:t.imgPath+t.data.images[0],alt:""}})]):t._e(),t._v(" "),i("div",{staticClass:"daily-title",class:{noImg:!t.data.images}},[t._v(t._s(t.data.title)+"\n  ")])])},staticRenderFns:[]};var d=i("VU/8")(r,l,!1,function(t){i("XRxB")},"data-v-382c66a6",null).exports,m={getUnix:function(){return(new Date).getTime()},getTodayUnix:function(){var t=new Date;return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t.getTime()},getYearUnix:function(){var t=new Date;return t.setMonth(0),t.setDate(1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t.getTime()},getLastDate:function(t){var e=new Date(t),i=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,a=e.getDate()<10?"0"+(e.getDay()+1):e.getDate();return e.getFullYear()+"-"+i+"-"+a},getFormatTime:function(t){var e=this.getUnix(),i=this.getTodayUnix(),a=(this.getYearUnix(),(e-t)/1e3),n="";switch(!0){case Math.floor(a/60<=0):n="刚刚";break;case a<3600:n=Math.floor(a/60)+"分钟前";break;case a>=3600&&t-i>=0:n=Math.floor(a/3600)+"小时前";break;case a/86400<=31:n=Math.floor(a/86400)+"天前";break;default:n=this.getLastDate(t)}return n}},h={name:"daily-article",directives:{Time:{bind:function(t,e){t.innerText=m.getFormatTime(1e3*e.value),t.__timeout__=setInterval(function(){t.innerText=m.getFormatTime(1e3*e.value)},6e4)},unbind:function(t){clearInterval(t.__timeout__),delete t.__timeout__}}},props:{id:{type:Number}},data:function(){return{data:{},comments:[],isLoading:!1,CancelToken:s.a.CancelToken,cancel:null}},methods:{getArticle:function(){var t=this;this.isLoading&&this.cancel(),this.isLoading=!0,document.body.style.overflow="hidden",c.ajax.get("news/"+this.id,{cancelToken:new this.CancelToken(function(e){t.cancel=e})}).then(function(e){e.body=e.body.replace(/src="http/g,'src="'+c.imgPath+"http"),e.body=e.body.replace(/src="https/g,'src="'+c.imgPath+"https"),e.body=e.body.replace(/<div class="img-place-holder"><\/div>/,""),t.data=e,t.isLoading=!1,window.scrollTo(0,0),document.body.style.overflow="auto"}).catch(function(t){s.a.isCancel(t)&&console.log("Request canceled",t.message)})},getComments:function(){var t=this;c.ajax.get("story/"+this.id+"/short-comments").then(function(e){t.comments=e.comments.map(function(t){return t.avatar=c.imgPath+t.avatar,t})})}},computed:{getTitleImg:function(){if(this.data.image||this.data.images){var t=this.data.image||this.data.images[0];return{background:"url("+(t=c.imgPath+t)+") center center"}}}},watch:{id:function(t){t&&(this.getArticle(),this.getComments())}}},u={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"daily-article"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.isLoading,expression:"isLoading"}],staticClass:"loading-modal"},[i("div",{staticClass:"loading-icon"})]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.data.image,expression:"data.image"}],staticClass:"img-place-holder",style:t.getTitleImg},[i("div",{staticClass:"daily-article-title"},[t._v(t._s(t.data.title))])]),t._v(" "),i("div",{domProps:{innerHTML:t._s(t.data.body)}}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.comments.length,expression:"comments.length"}],staticClass:"daily-comments"},[i("span",[t._v("评论("+t._s(t.comments.length)+")")]),t._v(" "),t._l(t.comments,function(e){return i("div",{key:e.id,staticClass:"daily-comment"},[i("div",{staticClass:"daily-comment-avatar"},[i("img",{attrs:{src:e.avatar,alt:""}})]),t._v(" "),i("div",{staticClass:"daily-comment-content"},[i("div",{staticClass:"daily-comment-name"},[t._v(t._s(e.author))]),t._v(" "),i("div",{directives:[{name:"time",rawName:"v-time",value:e.time,expression:"comment.time"}],staticClass:"daily-comment-time"}),t._v(" "),i("div",{staticClass:"daily-comment-text"},[t._v(t._s(e.content))])])])})],2)])},staticRenderFns:[]},g={name:"App",components:{Item:d,dailyArticle:i("VU/8")(h,u,!1,null,null,null).exports},data:function(){return{themes:[],showThemes:!1,type:"recommend",themeId:0,list:[],isLoading:!1,recommendList:[],dailyTime:c.getTodayTime(),articleId:0,firstLoading:!0}},methods:{getThemes:function(){var t=this;c.ajax.get("themes").then(function(e){return t.themes=e.others})},handleToTheme:function(t){var e=this;this.type="daily",this.themeId=t,this.list=[],this.isLoading=!0,c.ajax.get("theme/"+t).then(function(t){e.list=t.stories.filter(function(t){return 1!==t.type}),e.isLoading=!1})},handleToRecommend:function(){this.type="recommend",this.recommendList=[],this.dailyTime=c.getTodayTime(),this.getRecommendList()},getRecommendList:function(){var t=this;this.isLoading=!0;var e=c.prevDay(this.dailyTime+864e5);c.ajax.get("news/before/"+e).then(function(e){t.recommendList.push(e),t.isLoading=!1,t.firstLoading&&(t.articleId=t.recommendList[0].stories[0].id,t.firstLoading=!1)})},formatDay:function(t){var e=t.substr(0,4),i=t.substr(4,2),a=t.substr(6,2);return e+"年 "+i+"月 "+a+"日 星期"+c.getDay(new Date(e+"-"+i+"-"+a).getTime())},handleScroll:function(){var t=this.$refs.list;"daily"===this.type||this.isLoading||t.scrollTop+document.body.clientHeight>=t.scrollHeight&&(this.dailyTime-=864e5,this.getRecommendList())},handleClick:function(t){this.articleId=t}},mounted:function(){this.getThemes(),this.getRecommendList()}},v={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"daily"},[i("div",{staticClass:"daily-menu"},[i("div",{staticClass:"daily-menu-item",class:{on:"recommend"===t.type},on:{click:t.handleToRecommend}},[t._v("每日推荐\n    ")]),t._v(" "),i("div",{staticClass:"daily-menu-item",class:{on:"daily"===t.type},on:{click:function(e){t.showThemes=!t.showThemes}}},[t._v("主题日报\n    ")]),t._v(" "),i("ul",{directives:[{name:"show",rawName:"v-show",value:t.showThemes,expression:"showThemes"}]},t._l(t.themes,function(e){return i("li",{key:e.id},[i("a",{class:{on:e.id===t.themeId&&"daily"===t.type},attrs:{href:"#"},on:{click:function(i){t.handleToTheme(e.id)}}},[t._v(t._s(e.name))])])}))]),t._v(" "),i("div",{ref:"list",staticClass:"daily-list",on:{scroll:t.handleScroll}},["recommend"===t.type?t._l(t.recommendList,function(e){return i("div",{key:e.date},[i("div",{staticClass:"daily-date"},[t._v(t._s(t.formatDay(e.date)))]),t._v(" "),t._l(e.stories,function(e){return i("Item",{key:e.id,class:{on:e.id===t.articleId},attrs:{data:e},nativeOn:{click:function(i){t.handleClick(e.id)}}})})],2)}):"daily"===t.type?t._l(t.list,function(e){return i("Item",{key:e.id,class:{on:e.id===t.articleId},attrs:{data:e},nativeOn:{click:function(i){t.handleClick(e.id)}}})}):t._e(),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isLoading,expression:"isLoading"}],staticClass:"list-loading"})],2),t._v(" "),i("daily-article",{attrs:{id:t.articleId}})],1)},staticRenderFns:[]};var f=i("VU/8")(g,v,!1,function(t){i("mL8a")},null,null).exports;i("Q0/0");a.a.config.productionTip=!1,new a.a({el:"#app",components:{App:f},template:"<App/>"})},"Q0/0":function(t,e){},XRxB:function(t,e){},mL8a:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.0f27e762686a383a5bc7.js.map